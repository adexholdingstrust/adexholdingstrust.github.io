<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Executive Report | Adex Holdings Trust</title>

  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="assets/styles.css"/>

  <style>
    /* EXECUTIVE-ONLY STYLES */
    .report-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:28px;
    }

    .report-title h1 {
      margin:0;
      font-size:30px;
    }

    .report-title p {
      margin:6px 0 0;
      opacity:.7;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:18px;
    }

    .metric {
      padding:20px;
      border-radius:14px;
      background:linear-gradient(135deg,#111,#1b1b1b);
      border:1px solid var(--line);
    }

    .metric h3 {
      margin:0;
      font-size:14px;
      opacity:.7;
      letter-spacing:.04em;
      text-transform:uppercase;
    }

    .metric .value {
      font-size:34px;
      margin-top:8px;
      font-weight:600;
    }

    .metric .trend {
      font-size:22px;
      margin-left:6px;
    }

    .metric .delta {
      margin-top:6px;
      font-size:13px;
      opacity:.8;
    }

    .section {
      margin-top:36px;
    }

    .section h2 {
      margin-bottom:14px;
      font-size:22px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      background:#0f0f0f;
      border-radius:12px;
      overflow:hidden;
    }

    th, td {
      padding:14px;
      text-align:left;
      font-size:14px;
      border-bottom:1px solid var(--line);
    }

    th {
      background:#141414;
      opacity:.75;
    }

    tr:last-child td {
      border-bottom:none;
    }

    .badge {
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      background:#2a2a2a;
    }

    .badge.high {
      background:#8b0000;
      color:#fff;
    }

    .badge.medium {
      background:#b8860b;
      color:#fff;
    }

    .badge.low {
      background:#2e8b57;
      color:#fff;
    }

    .insight {
      background:#101010;
      border-left:4px solid #4da3ff;
      padding:16px 18px;
      border-radius:10px;
      margin-top:14px;
    }
  </style>
</head>

<body>
<div class="container">

  <!-- NAV -->
  <div class="nav">
    <a class="brand" href="index.html">
      <img src="assets/logo.png" alt="logo"/>
      <div>
        <div class="title">ADEX HOLDINGS TRUST</div>
        <div class="subtitle">Executive Intelligence</div>
      </div>
    </a>
  </div>

  <!-- HEADER -->
  <div class="report-header">
    <div class="report-title">
      <h1>Executive Activity Report</h1>
      <p>Portfolio engagement & market demand overview</p>
    </div>
    <div class="small">
      Last updated: <span id="reportTime"></span>
    </div>
  </div>

  <!-- KPI SUMMARY -->
  <div class="grid" id="kpiSummary"></div>

  <!-- PROPERTY PERFORMANCE -->
  <div class="section">
    <h2>Top Performing Properties</h2>
    <table id="topProperties">
      <thead>
        <tr>
          <th>Property</th>
          <th>Type</th>
          <th>Views</th>
          <th>Engagement Score</th>
          <th>Risk Level</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- STRATEGIC INSIGHTS -->
  <div class="section">
    <h2>Executive Insights</h2>
    <div id="insights"></div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <div class="hr"></div>
    <div class="small">
      Confidential • For Executive Use Only • © 2025 Adex Holdings Trust
    </div>
  </div>

</div>

<script src="assets/app.js"></script>

<script>
(async function(){
  const fmt = (n)=> n.toLocaleString();

  document.getElementById("reportTime").textContent =
    new Date().toLocaleString("en-US",{timeZone:"America/Los_Angeles"});

  const k7  = await fetch("/api/admin/kpi?days=7").then(r=>r.json());
  const k30 = await fetch("/api/admin/kpi?days=30").then(r=>r.json());
  const engagement = await fetch("/api/admin/engagement").then(r=>r.json());

  const grid = document.getElementById("kpiSummary");

  function trendArrow(shortVal,longVal){
    if(!longVal) return "→";
    const delta = (shortVal - longVal) / longVal;
    if(delta > 0.1) return "↑";
    if(delta < -0.1) return "↓";
    return "→";
  }

  function card(title,val,trend,subtitle){
    return `
      <div class="metric">
        <h3>${title}</h3>
        <div class="value">
          ${fmt(val)}
          <span class="trend">${trend}</span>
        </div>
        <div class="delta">${subtitle}</div>
      </div>`;
  }

  const baseline30 = {
    events: k30.totalEvents / 4,
    views:  k30.views / 4,
    severity: k30.highSeverity / 4
  };

  grid.innerHTML =
    card(
      "7-Day Activity",
      k7.totalEvents,
      trendArrow(k7.totalEvents, baseline30.events),
      "vs 30-day baseline"
    ) +
    card(
      "Property Views",
      k7.views,
      trendArrow(k7.views, baseline30.views),
      "High-intent interactions"
    ) +
    card(
      "High Severity Signals",
      k7.highSeverity,
      trendArrow(k7.highSeverity, baseline30.severity),
      "Conversion indicators"
    ) +
    card(
      "Unique Properties",
      k7.uniqueProperties,
      "→",
      "Demand diversity"
    );

  const tbody = document.querySelector("#topProperties tbody");

  engagement.ranking.slice(0,5).forEach(p=>{
    const risk =
      p.score >= 15 ? "high" :
      p.score >= 8  ? "medium" : "low";

    tbody.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>${p.propertyType}</td>
        <td>${p.views}</td>
        <td>${p.score}</td>
        <td><span class="badge ${risk}">${risk.toUpperCase()}</span></td>
      </tr>`;
  });

  document.getElementById("insights").innerHTML = `
    <div class="insight">
      Demand momentum over the past 7 days is being used to assess near-term acquisition and leasing potential.
    </div>
    <div class="insight">
      Engagement is concentrated among a limited number of high-performing properties, indicating prioritization opportunities.
    </div>
    <div class="insight">
      Severity signals suggest increased readiness for conversion compared to historical averages.
    </div>`;
})();
</script>

</body>
</html>
