<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="robots" content="noindex,nofollow"/>
  <title>Adex Holdings Trust | Admin</title>

  <!-- HARD CONTEXT BLOCK -->
  <script>
  (function () {
    if (location.pathname.startsWith("/cdn-cgi/access")) return;
    if (
      location.protocol !== "https:" ||
      location.hostname !== "adexholdings.com" ||
      location.pathname !== "/admin.html"
    ) {
      document.open();
      document.write(`
        <!doctype html>
        <html><head><title>Access Restricted</title></head>
        <body style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:Arial">
          <div>
            <h2>Access Restricted</h2>
            <p>This account has no access to this page.</p>
          </div>
        </body></html>
      `);
      document.close();
      throw new Error("Blocked context");
    }
  })();
  </script>

  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="assets/styles.css"/>

  <!-- Mapbox -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <!-- MOBILE + LAYOUT FIXES -->
  <style>
    input, textarea, select { font-size: 16px; }

    button, .btn, a {
      min-height: 44px;
      min-width: 44px;
    }

    .container.withSidebar {
      margin-left: 260px;
      transition: margin-left 0.25s ease;
    }

    .adminSidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 260px;
      height: 100vh;
      background: #0f1115;
      z-index: 1200;
      transition: left 0.25s ease;
    }

    .mobileToggle {
      display: none;
    }

    @media (max-width: 900px) {
      body.admin {
        overflow-x: hidden;
      }

      .adminSidebar {
        left: -260px;
      }

      .adminSidebar.open {
        left: 0;
      }

      .container.withSidebar {
        margin-left: 0 !important;
        padding: 14px;
      }

      body.sidebar-open {
        overflow: hidden;
      }

      .mobileToggle {
        display: flex;
        position: fixed;
        top: 14px;
        left: 14px;
        z-index: 1400;
        background: #0f1115;
        color: #fff;
        border-radius: 8px;
        padding: 10px 14px;
        font-size: 22px;
      }

      .kpiGrid {
        grid-template-columns: 1fr !important;
      }

      table.table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }

      #adminHeatmap {
        height: 300px !important;
      }

      .card {
        margin-bottom: 18px;
      }
    }

    .card, .container {
      -webkit-overflow-scrolling: touch;
    }
  </style>
</head>

<body class="admin">

<!-- MOBILE TOGGLE -->
<button class="mobileToggle" id="sideToggle">â˜°</button>

<!-- SIDEBAR -->
<aside class="adminSidebar" id="adminSidebar">
  <div class="sideBrand">
    <img src="assets/logo.png" alt="Adex Holdings Trust"/>
    <span>Admin</span>
  </div>

  <nav class="sideNav">
    <a href="#kpiDashboard" class="active">Overview</a>
    <a href="#propertyRanking">Engagement</a>
    <a href="#heatmap">Heatmap</a>
    <a href="#events">Events</a>
    <a href="#availability">Availability</a>
    <a href="#audit">Audit</a>
  </nav>
</aside>

<!-- MAIN CONTENT -->
<div class="container withSidebar">

  <!-- TOP NAV -->
  <div class="nav">
    <div class="brand">
      <img src="assets/logo.png" alt="Adex Holdings Trust"/>
      <div>
        <div class="title">ADEX HOLDINGS TRUST</div>
        <div class="subtitle">Admin Portal</div>
      </div>
    </div>
    <div id="whoami" class="badge">Loading identityâ€¦</div>
  </div>

  <div id="maintenanceBanner" class="notice danger" style="display:none">
    ðŸš¨ Maintenance Mode Active
  </div>

  <!-- KPI DASHBOARD -->
  <div class="card" id="kpiDashboard">
    <div class="kicker">Analytics</div>
    <div class="h1">Overview Dashboard</div>
    <div class="kpiGrid"></div>
  </div>

  <!-- ENGAGEMENT -->
  <div class="card" id="propertyRanking">
    <div class="kicker">Analytics</div>
    <div class="h1">Property Engagement Ranking</div>
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Property</th>
          <th>Views</th>
          <th>High Severity</th>
          <th>Score</th>
          <th>Last Seen</th>
        </tr>
      </thead>
      <tbody id="engagementRankingBody"></tbody>
    </table>
  </div>

  <!-- HEATMAP -->
  <div class="card" id="heatmap">
    <div class="kicker">Analytics</div>
    <div class="h1">Event Heatmap</div>
    <div id="adminHeatmap" style="height:420px;border-radius:12px;"></div>
  </div>

  <!-- EVENTS -->
  <div class="card" id="events">
    <div class="kicker">Analytics</div>
    <div class="h1">Tracked Events</div>
    <div id="adminControls"></div>
    <table class="table" id="eventsTable">
      <thead>
        <tr>
          <th>Time</th>
          <th>Type</th>
          <th>Property</th>
          <th>Location</th>
          <th>Severity</th>
          <th>IP / ASN</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- AVAILABILITY -->
  <div class="card" id="availability">
    <div class="kicker">Admin</div>
    <div class="h1">Rental Availability</div>
    <div id="adminList" class="availabilityGrid"></div>
    <div class="btnRow">
      <button id="saveBtn" class="btn primary">Save availability</button>
    </div>
  </div>

  <!-- AUDIT -->
  <div class="card" id="audit">
    <div class="kicker">Audit</div>
    <div class="h1">Admin Activity</div>
    <table class="table" id="auditTable">
      <thead>
        <tr>
          <th>Time</th>
          <th>User</th>
          <th>Action</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script src="assets/data.js"></script>
<script src="assets/app.js"></script>

<!-- SIDEBAR TOGGLE -->
<script>
(function () {
  const toggle = document.getElementById("sideToggle");
  const sidebar = document.getElementById("adminSidebar");

  toggle.addEventListener("click", () => {
    sidebar.classList.toggle("open");
    document.body.classList.toggle("sidebar-open");
  });

  sidebar.querySelectorAll("a").forEach(link => {
    link.addEventListener("click", () => {
      sidebar.classList.remove("open");
      document.body.classList.remove("sidebar-open");
    });
  });
})();
</script>

</body>
</html>
