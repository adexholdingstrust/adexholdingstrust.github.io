<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="robots" content="noindex,nofollow"/>
<title>Adex Holdings Trust | Admin</title>

<link rel="icon" href="assets/logo.png"/>
<link rel="stylesheet" href="assets/styles.css"/>

<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

<style>
/* ===============================
   ROOT / THEMING
================================ */
:root {
  --bg: #0b0f14;
  --panel: #121822;
  --text: #e6ebf0;
  --muted: #9aa4af;
  --line: rgba(255,255,255,.08);
  --accent: #3ddc97;
}

[data-theme="light"] {
  --bg: #f6f8fb;
  --panel: #ffffff;
  --text: #1b1f24;
  --muted: #5f6b7a;
  --line: rgba(0,0,0,.08);
  --accent: #0b7cff;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  color: var(--text);
  overflow: hidden;
}

body.admin {
  display: flex;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
}

/* ===============================
   SIDEBAR
================================ */
.adminSidebar {
  width: 240px;
  background: var(--panel);
  border-right: 1px solid var(--line);
  height: 100vh;
  display: flex;
  flex-direction: column;
  transition: width .25s ease;
}

.adminSidebar.collapsed {
  width: 68px;
}

.sideBrand {
  display:flex;
  align-items:center;
  gap:10px;
  padding:16px;
  font-weight:600;
}

.sideBrand img {
  width:34px;
  height:34px;
}

.sideNav {
  display:flex;
  flex-direction:column;
  gap:6px;
  padding:8px;
}

.sideNav a {
  padding:10px 12px;
  border-radius:8px;
  color:var(--text);
  text-decoration:none;
  font-size:14px;
}

.sideNav a:hover,
.sideNav a.active {
  background:rgba(61,220,151,.12);
}

.sideFooter {
  margin-top:auto;
  padding:12px;
  border-top:1px solid var(--line);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.sideToggle {
  background:none;
  border:none;
  color:var(--text);
  font-size:20px;
  cursor:pointer;
}

/* ===============================
   MAIN CONTENT
================================ */
.container.withSidebar {
  flex:1;
  height:100vh;
  overflow-y:auto;
  padding:20px 24px 140px;
  box-sizing:border-box;
}

/* ===============================
   NAV BAR
================================ */
.nav {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}

.badge {
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  border:1px solid var(--line);
}

/* ===============================
   BREADCRUMBS
================================ */
.breadcrumbs {
  font-size:13px;
  color:var(--muted);
  margin-bottom:12px;
}

.breadcrumbs span {
  opacity:.6;
}

/* ===============================
   STICKY KPI BAR
================================ */
.stickyKPI {
  position:sticky;
  top:0;
  z-index:30;
  background:var(--bg);
  padding-bottom:12px;
}

/* ===============================
   CARDS
================================ */
.card {
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:16px;
  padding:18px;
  margin-bottom:26px;
}

.h1 {
  font-size:26px;
  margin:6px 0 10px;
}

.kicker {
  font-size:12px;
  text-transform:uppercase;
  color:var(--muted);
}

/* ===============================
   TABLES
================================ */
.table {
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}

.table th, .table td {
  padding:10px 8px;
  border-bottom:1px solid var(--line);
  white-space:nowrap;
}

/* ===============================
   MOBILE
================================ */
@media (max-width: 960px) {
  .adminSidebar {
    position:fixed;
    z-index:60;
    transform:translateX(-100%);
  }
  .adminSidebar.open {
    transform:translateX(0);
  }
}
</style>
</head>

<body class="admin" data-theme="dark">

<!-- SIDEBAR -->
<aside class="adminSidebar" id="sidebar">
  <div class="sideBrand">
    <img src="assets/logo.png"/>
    <span>Admin</span>
  </div>

  <nav class="sideNav">
    <a href="#adminKPI" class="active">Overview</a>
    <a href="#propertyRanking">Engagement</a>
    <a href="#adminHeatmap">Heatmap</a>
    <a href="#events">Events</a>
    <a href="#availability">Availability</a>
    <a href="#audit">Audit</a>
  </nav>

  <div class="sideFooter">
    <button class="sideToggle" id="collapseBtn">â˜°</button>
    <button class="sideToggle" id="themeBtn">ðŸŒ“</button>
  </div>
</aside>

<!-- MAIN -->
<div class="container withSidebar">

  <!-- NAV -->
  <div class="nav">
    <button class="sideToggle" id="mobileNavBtn">â˜°</button>
    <div id="whoami" class="badge">Loadingâ€¦</div>
  </div>

  <!-- BREADCRUMBS -->
  <div class="breadcrumbs" id="breadcrumbs">
    Admin <span>â€º</span> Overview
  </div>

  <!-- STICKY KPI -->
  <div class="stickyKPI">
    <div class="card" id="adminKPI">
      <div class="kicker">Analytics</div>
      <div class="h1">Key Performance Indicators</div>
      <div class="small" id="kpiUpdated">Last updated: â€”</div>
    </div>
  </div>

  <!-- ENGAGEMENT -->
  <div class="card" id="propertyRanking">
    <div class="kicker">Analytics</div>
    <div class="h1">Property Engagement Ranking</div>
    <table class="table">
      <thead>
        <tr>
          <th>#</th><th>Property</th><th>Views</th>
          <th>Severity</th><th>Score</th><th>Last Seen (PST)</th>
        </tr>
      </thead>
      <tbody id="engagementRankingBody"></tbody>
    </table>
  </div>

  <!-- HEATMAP -->
  <div class="card">
    <div class="kicker">Analytics</div>
    <div class="h1">Event Heatmap</div>
    <div id="adminHeatmap" style="height:420px;border-radius:12px"></div>
  </div>

  <!-- EVENTS -->
  <div class="card" id="events">
    <div class="kicker">Analytics</div>
    <div class="h1">Tracked Events</div>
    <table class="table" id="eventsTable">
      <thead>
        <tr>
          <th>Time (PST)</th><th>Type</th><th>Path</th>
          <th>Location</th><th>Severity</th><th>IP</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- AVAILABILITY -->
  <div class="card" id="availability">
    <div class="kicker">Admin</div>
    <div class="h1">Rental Availability</div>
    <div id="adminList"></div>
    <button id="saveBtn" class="btn primary">Save availability</button>
  </div>

  <!-- AUDIT -->
  <div class="card" id="audit">
    <div class="kicker">Audit</div>
    <div class="h1">Admin Activity</div>
    <table class="table" id="auditTable">
      <thead>
        <tr>
          <th>Time (PST)</th><th>User</th><th>Action</th><th>Details</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script src="assets/data.js"></script>
<script src="assets/app.js"></script>

<script>
/* ===============================
   UI ENHANCEMENTS (HTML ONLY)
================================ */

// Sidebar collapse
collapseBtn.onclick = () =>
  sidebar.classList.toggle("collapsed");

// Mobile nav
mobileNavBtn.onclick = () =>
  sidebar.classList.toggle("open");

// Theme toggle
const themeBtn = document.getElementById("themeBtn");
themeBtn.onclick = () => {
  const t = document.body.dataset.theme === "dark" ? "light" : "dark";
  document.body.dataset.theme = t;
  localStorage.setItem("adminTheme", t);
};
document.body.dataset.theme = localStorage.getItem("adminTheme") || "dark";

// Breadcrumbs auto-update
const sections = [...document.querySelectorAll(".card")];
const bc = document.getElementById("breadcrumbs");

const obs = new IntersectionObserver(
  entries => {
    entries.forEach(e => {
      if (e.isIntersecting) {
        const title = e.target.querySelector(".h1")?.textContent;
        if (title) bc.innerHTML = `Admin <span>â€º</span> ${title}`;
      }
    });
  },
  { threshold: .3 }
);
sections.forEach(s => obs.observe(s));

// PST formatter
function fmtPST(ts) {
  return new Date(ts).toLocaleString("en-US", {
    timeZone: "America/Los_Angeles"
  });
}

// Auto-convert timestamps
setTimeout(() => {
  document.querySelectorAll("td").forEach(td => {
    if (td.textContent?.includes("T") && td.textContent.includes("Z")) {
      td.textContent = fmtPST(td.textContent.trim());
    }
  });
  const k = document.getElementById("kpiUpdated");
  if (k) k.textContent = "Last updated: " + fmtPST(new Date().toISOString());
}, 1200);
</script>

</body>
</html>
